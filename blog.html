<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="nav.blog">Blog - PosturaIA</title>
    <link rel="stylesheet" href="assets/css/theme.css">
</head>
<body>
    <header id="main-header"></header>
    
    <main style="max-width: 1100px; margin: 3rem auto; padding: 0 1.5rem;">
        <h1 data-i18n="blog.title" style="margin-bottom: 3rem; color: var(--primary); text-align: center; font-size: 2.5rem;">Blog PosturaIA</h1>
        
        <div id="blog-list" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 2.5rem;">
            <div style="grid-column: 1/-1; padding: 5rem; text-align: center; color: var(--text-muted);" data-i18n="blog.loading">Chargement des articles...</div>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script type="module">
        import "./assets/js/ui-orchestrator.js";
        
        async function loadBlog() {
            const container = document.getElementById('blog-list');
            const lang = localStorage.getItem('posturaia_lang') || 'fr';
            const responseI18n = await fetch(`i18n/${lang}.json`);
            const t = await responseI18n.json();

            try {
                const response = await fetch('assets/blog/posts.json');
                const posts = await response.json();
                const filteredPosts = posts.filter(p => p.lang === lang);

                if (filteredPosts.length === 0) {
                    container.innerHTML = `<div style="grid-column: 1/-1; padding: 5rem; text-align: center; background: white; border-radius: 12px; border: 1px solid var(--border);">${t.blog.empty}</div>`;
                    return;
                }

                container.innerHTML = filteredPosts.map(p => `
                    <div class="card" style="padding: 0; overflow: hidden; display: flex; flex-direction: column; height: 100%;">
                        <div style="height: 220px; background: #e2e8f0; position: relative; overflow: hidden;">
                            ${p.hero_image ? 
                                `<img src="${p.hero_image}" alt="${p.title}" style="width: 100%; height: 100%; object-fit: cover;">` : 
                                `<div style="width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #94a3b8; background: linear-gradient(135deg, #f8fafb 0%, #e2e8f0 100%);">
                                    <span style="font-size: 3rem; margin-bottom: 0.5rem;">ðŸ§˜</span>
                                    <span style="font-weight: 700; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.1em;">PosturaIA Insight</span>
                                 </div>`
                            }
                            <div style="position: absolute; top: 1rem; right: 1rem; background: var(--secondary); color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.75rem; font-weight: 700;">
                                ${new Date(p.date || Date.now()).toLocaleDateString(lang === 'fr' ? 'fr-FR' : 'en-US', { month: 'short', year: 'numeric' })}
                            </div>
                        </div>
                        <div style="padding: 2rem; flex-grow: 1; display: flex; flex-direction: column;">
                            <h3 style="margin-bottom: 1rem; color: var(--primary); font-size: 1.25rem; line-height: 1.3;">${p.title}</h3>
                            <p style="font-size: 0.95rem; color: var(--text-muted); margin-bottom: 2rem; line-height: 1.6; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden;">${p.excerpt}</p>
                            <div style="margin-top: auto;">
                                <a href="blog-post.html?id=${p.id}" class="btn btn-outline" style="width: 100%; font-size: 0.9rem; font-weight: 700;">${t.blog.read_more}</a>
                            </div>
                        </div>
                    </div>
                `).join('');
            } catch (e) {
                console.error("Blog load error:", e);
                container.innerHTML = `<div style="grid-column: 1/-1; padding: 5rem; text-align: center; color: #ef4444; font-weight: 600;">Erreur lors du chargement du blog.</div>`;
            }
        }
        loadBlog();
    </script>
</body>
</html>
